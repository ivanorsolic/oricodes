<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.62.1" />
    <meta name="description" content="Ori&#39;s self-driving RC car">
<meta name="author" content="ori">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Finding lane lines easier :: Ori Codes</title>

    
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/css/auto-complete.css" rel="stylesheet">
    
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/hugo-theme.css" rel="stylesheet">
    
      <link href="/css/theme-mine.css" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
   "HTML-CSS": { linebreaks: { automatic: true } },
           SVG: { linebreaks: { automatic: true } }
  });
  </script>
<script type="text/javascript" async
  src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['++','++']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/artificial-intelligence/computer-vision-lane-finding/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ori.codes/">
  <img src="/images/logo.png">
</a>

	  2700 words.<br>
	  Reading time: 13 minutes.
	  
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js"></script>
<script type="text/javascript" src="/js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ori.codes\/";
    
</script>
<script type="text/javascript" src="/js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/rc-car/" title="RC Cars: a primer" class="dd-item 
        
        
        
        ">
      <a href="/rc-car/">
          <b>1. </b>RC Cars: a primer
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/rc-car/parts_list/" title="Parts: an overview" class="dd-item ">
        <a href="/rc-car/parts_list/">
        Parts: an overview
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/scale/" title="Scale" class="dd-item ">
        <a href="/rc-car/scale/">
        Scale
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/body_type/" title="RC Car body types" class="dd-item ">
        <a href="/rc-car/body_type/">
        Body type
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/electric_motors/" title="Electric motors" class="dd-item ">
        <a href="/rc-car/electric_motors/">
        Electric motors
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/servo/" title="Steering servo" class="dd-item ">
        <a href="/rc-car/servo/">
        Servo
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/electronic_speed_controller/" title="Electronic Speed Controller" class="dd-item ">
        <a href="/rc-car/electronic_speed_controller/">
        ESC
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/receiver/" title="Receiver" class="dd-item ">
        <a href="/rc-car/receiver/">
        Receiver
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/batteries/" title="Batteries" class="dd-item ">
        <a href="/rc-car/batteries/">
        Batteries
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/hardware/" title="Hardware" class="dd-item 
        
        
        
        ">
      <a href="/hardware/">
          <b>2. </b>Hardware
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/hardware/inventory/" title="Hardware inventory" class="dd-item ">
        <a href="/hardware/inventory/">
        Inventory: stuff you&#39;ll need
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/building-the-car/" title="Assembling the RC Car" class="dd-item ">
        <a href="/hardware/building-the-car/">
        Assembling the RC Car
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/mounting-plates/" title="Building the mounting plates for the hardware" class="dd-item ">
        <a href="/hardware/mounting-plates/">
        Mounting plates
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/jetson-nano-installation/" title="Preparing the Jetson Nano" class="dd-item ">
        <a href="/hardware/jetson-nano-installation/">
        Preparing the Jetson Nano
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/assembling-the-nano/" title="Assembling the Jetson Nano" class="dd-item ">
        <a href="/hardware/assembling-the-nano/">
        Assembling the Jetson Nano
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/connecting-the-car-to-the-nano/" title="Connecting the RC to the Nano" class="dd-item ">
        <a href="/hardware/connecting-the-car-to-the-nano/">
        Connecting the RC to the Nano
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/software/" title="Software" class="dd-item 
        
        
        
        ">
      <a href="/software/">
          <b>3. </b>Software
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/software/kernel-hacking/" title="Running the OS from an external SSD using a custom kernel" class="dd-item ">
        <a href="/software/kernel-hacking/">
        OPTIONAL: Kernel Hacking
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar/" title="DonkeyCar" class="dd-item ">
        <a href="/software/donkeycar/">
        DonkeyCar: Explained
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar-host/" title="DonkeyCar installation: Host PC" class="dd-item ">
        <a href="/software/donkeycar-host/">
        DonkeyCar: Host PC
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar-simulator/" title="DonkeyCar Installation: The Simulator" class="dd-item ">
        <a href="/software/donkeycar-simulator/">
        DonkeyCar: Simulator
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar-rc/" title="DonkeyCar installation: RC car" class="dd-item ">
        <a href="/software/donkeycar-rc/">
        DonkeyCar: RC car
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/setting-up-donkeycar-on-the-rc/" title="DonkeyCar configuration: RC car" class="dd-item ">
        <a href="/software/setting-up-donkeycar-on-the-rc/">
        DonkeyCar configuration: RC car
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/calibrating-steering-and-throttle/" title="Calibrating steering and throttle" class="dd-item ">
        <a href="/software/calibrating-steering-and-throttle/">
        Calibrating steering and throttle
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/connecting-a-bluetooth-gamepad/" title="Using a gamepad" class="dd-item ">
        <a href="/software/connecting-a-bluetooth-gamepad/">
        Using a gamepad
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/test-driving-the-rc/" title="Test drive" class="dd-item ">
        <a href="/software/test-driving-the-rc/">
        Test drive
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/sanity-check-first-autopilot/" title="First Autopilot: sanity check" class="dd-item ">
        <a href="/software/sanity-check-first-autopilot/">
        First Autopilot: sanity check
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/artificial-intelligence/" title="Artificial Intelligence" class="dd-item 
        parent
        
        
        ">
      <a href="/artificial-intelligence/">
          <b>4. </b>Artificial Intelligence
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/custom-architecture/" title="Creating our first custom network architecture" class="dd-item ">
        <a href="/artificial-intelligence/custom-architecture/">
        Creating our first model
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/artificial-intelligence/visualization/" title="Visualizations" class="dd-item 
        
        
        
        ">
      <a href="/artificial-intelligence/visualization/">
          Visualizations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/visualization/cnn-activations/" title="Visualization: CNN Activations" class="dd-item ">
        <a href="/artificial-intelligence/visualization/cnn-activations/">
        CNN Activations
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/visualization/saliency-maps/" title="Visualization: Saliency Maps" class="dd-item ">
        <a href="/artificial-intelligence/visualization/saliency-maps/">
        Saliency Maps
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/visualization/donkey-makemovie/" title="Visualization: donkey makemovie" class="dd-item ">
        <a href="/artificial-intelligence/visualization/donkey-makemovie/">
        Donkey makemovie
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/artificial-intelligence/simulator-mod/" title="Creating a custom simulator" class="dd-item 
        
        
        
        ">
      <a href="/artificial-intelligence/simulator-mod/">
          Creating a custom simulator
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/simulator-mod/high-resolution-images/" title="Simulator mod: High resolution images" class="dd-item ">
        <a href="/artificial-intelligence/simulator-mod/high-resolution-images/">
        High res images
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/simulator-mod/custom-rc-model/" title="Simulator mod: Custom RC model" class="dd-item ">
        <a href="/artificial-intelligence/simulator-mod/custom-rc-model/">
        Custom RC model
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/artificial-intelligence/camera-calibration/" title="Camera distortions and calibration" class="dd-item 
        
        
        
        ">
      <a href="/artificial-intelligence/camera-calibration/">
          Camera distortions and calibration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/camera-calibration/camera-distortions/" title="Camera calibration: Explaining camera distortions" class="dd-item ">
        <a href="/artificial-intelligence/camera-calibration/camera-distortions/">
        Camera distortions
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/camera-calibration/implementing-camera-calibration/" title="Camera calibration: Implementing the calibration and undistortion" class="dd-item ">
        <a href="/artificial-intelligence/camera-calibration/implementing-camera-calibration/">
        Calibration implementation
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/camera-calibration/calibrating-the-camera/" title="Camera calibration: Calibrating the camera and undistorting images" class="dd-item ">
        <a href="/artificial-intelligence/camera-calibration/calibrating-the-camera/">
        Calibrating your camera and undistorting images
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/computer-vision-lane-finding/" title="Finding lane lines easier" class="dd-item active">
        <a href="/artificial-intelligence/computer-vision-lane-finding/">
        Extracting lanes from images
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/integrating-the-lane-finding/" title="Advanced lane finding model" class="dd-item ">
        <a href="/artificial-intelligence/integrating-the-lane-finding/">
        Advanced lane finding model
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/how-to-train-your-model/" title="Master recipe: How to learn your machines" class="dd-item ">
        <a href="/artificial-intelligence/how-to-train-your-model/">
        How to learn your machines
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/adding-behaviours/" title="Adding behaviours: automated lane changing" class="dd-item ">
        <a href="/artificial-intelligence/adding-behaviours/">
        Behaviours: Lane Changing
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/artificial-intelligence/object-detection-and-tracking/" title="Detecting and tracking objects on images" class="dd-item ">
        <a href="/artificial-intelligence/object-detection-and-tracking/">
        Object recognition and tracking
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/extras/" title="Extras" class="dd-item 
        
        
        
        ">
      <a href="/extras/">
          <b>5. </b>Extras
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/extras/hosting-the-website/" title="How is this website made?" class="dd-item ">
        <a href="/extras/hosting-the-website/">
        How is this website made?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/how-is-this-website-made/" title="How is this website made?" class="dd-item ">
        <a href="/extras/how-is-this-website-made/">
        How is this website made?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/static-websites/" title="Static websites" class="dd-item ">
        <a href="/extras/static-websites/">
        Static websites
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/prerequisites/" title="You&#39;ll need:" class="dd-item ">
        <a href="/extras/prerequisites/">
        Prerequisites
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/creating-a-demo-website/" title="Creating a website with Hugo" class="dd-item ">
        <a href="/extras/creating-a-demo-website/">
        Creating a website with Hugo
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/hosting/" title="Where will we be hosting the site?" class="dd-item ">
        <a href="/extras/hosting/">
        Hosting the site
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/using-a-custom-domain/" title="Using a custom domain" class="dd-item ">
        <a href="/extras/using-a-custom-domain/">
        Using a custom domain
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/draft-and-todo/" title="Drafts and #TODO&#39;s" class="dd-item 
        
        
        
        ">
      <a href="/draft-and-todo/">
          6. </b>Drafts and #TODO&#39;s
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/draft-and-todo/data-augmentation/" title="Augmenting the data with neural style transfer" class="dd-item ">
        <a href="/draft-and-todo/data-augmentation/">
        Data augmentation: ML meets art!
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/draft-and-todo/reinforcement-learning/" title="Reinforcement learning: letting the car learn to drive on its own" class="dd-item ">
        <a href="/draft-and-todo/reinforcement-learning/">
        Reinforcement learning
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/draft-and-todo/derivacije/" title="Raspisivanje math-a" class="dd-item ">
        <a href="/draft-and-todo/derivacije/">
        Random math stuff
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/draft-and-todo/hough-transform/" title="Raspisivanje Hough transform-a" class="dd-item ">
        <a href="/draft-and-todo/hough-transform/">
        Hough transform stuff
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    


    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://ori.codes/artificial-intelligence/computer-vision-lane-finding/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
	  
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
	  
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://drive.google.com/open?id=1UWx3KWlmyDX6hNNVlhsFmVdiUpEAnI8m"><i class='fas fa-graduation-cap'></i> Master's thesis</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/ivanorsolic"><i class='fab fa-github'></i> Github</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://twitter.com/ivanorsolic"><i class='fab fa-twitter'></i> Twitter</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://ivanorsolic.github.io"><i class='fas fa-tasks'></i> Other projects</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://drive.google.com/file/d/1OxfTifqPw3X5TqwcQMmdwOCJMiSAm1ED/view?usp=sharing"><i class='fas fa-file'></i> My CV</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://ivanorsolic.github.io/mastersPresentation"><i class='fas fa-presentation'></i> Master's thesis presentation</a>
              </li>
          
        </ul>
      </section>
    
      </ul>
    </section>
    
	
    <section id="footer">
      <p align="center">Built by <a href="https://twitter.com/ivanorsolic">Ori</a> with <a href="https://github.com/matcornic/hugo-theme-learn">Learn</i></a>, <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo.</a><br>
Hosted for free at <a href="https://app.netlify.com">Netlify <i class="fas fa-heart"></i></a>
</p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Finding lane lines easier 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-were-going-to-do">What we're going to do</a></li>
    <li><a href="#perspective-transform">Perspective transform</a></li>
    <li><a href="#implementing-the-perspective-transform">Implementing the perspective transform</a></li>
    <li><a href="#making-the-lane-lines-easier-to-see">Making the lane lines easier to see</a></li>
    <li><a href="#the-entire-process-visualized">The entire process visualized</a>
      <ul>
        <li><a href="#fitting-lanes-using-a-polynomial-approximation">Fitting lanes using a polynomial approximation</a></li>
        <li><a href="#using-additional-preprocessing-methods">Using additional preprocessing methods</a></li>
        <li><a href="#and-you-can-download-the-entire-jupyter-notebook-below">And you can download the entire Jupyter notebook below:</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Finding lane lines easier
            </h1>
          

        



<p>Remember we've showed before that our CNN is taking the horizon as the input feature, and that we'll be addressing it after making a simulator mod that'll allow us to take high res images. Well, here we are.</p>
<center><video controls src="/images/ai/lanelines.mp4" autoplay muted loop width=50%></video><video controls src="/images/ai/lanefinding.mp4" autoplay muted loop width=50%></video></center>
<h2 id="what-were-going-to-do">What we're going to do</h2>
<p>To solve the horizon problem and simultaneously help the car recognize lane lines better, we'll do the following:</p>
<ul>
<li>Perform a perspective transform on every input image to get a birds-eye view of the road</li>
<li>Convert the image to HLS color space, extract only the S channel and perform some thresholding on it to extract only the lanes from the input image</li>
</ul>
<h2 id="perspective-transform">Perspective transform</h2>
<p>There's one really useful thing we can do with our input images, and we kinda already did it while we were calibrating our camera; a perspective transform. So, what's a perspective transform? Let's say that this is our input image:</p>
<p><img src="/images/ai/perspective1.jpg" alt="452_cam-image_array_"></p>
<p>We talked a bit about how cameras map the 3D world onto a 2D plane, which certainly has some downsides. One of them would be this:</p>
<p><img src="/images/ai/perspective2.png" alt=""></p>
<p>We know that the lane lines in the real world are parallel, but if the only input information we had was the image above, we could easily assume that they intersect somewhere in the distance. Maybe it's easier to see on a photo of a real road:</p>
<p><img src="/images/ai/perspective3.jpg" alt="Concrete Road Between Trees" style="width:80%;" /></p>
<p><img src="/images/ai/perspective4.jpg" style="width:80%;" /></p>
<p>We could easily assume that the road gets narrower and narrower further on, until the outer lines intersect somewhere in the distance.</p>
<p>Now, if we had a birds-eye perspective, like this:</p>
<p><img src="/images/ai/perspective5.jpg" alt="Cars Passing Through Bridge"></p>
<p>We could easily see that the lane lines are parallel throughout the road, and that the width of a lane should stay the same.</p>
<p>Luckily for us, we don't have to train an autonomous drone to fly above our car and send images of the road to it, we can just do a perspective transform, and go from this:</p>
<p><img src="/images/ai/warped2.png" alt="452_cam-image_array_"></p>
<p>To this:</p>
<p><img src="/images/ai/warped.png" alt="warped"></p>
<h2 id="implementing-the-perspective-transform">Implementing the perspective transform</h2>
<p>As always, we'll be importing the stuff we need first, we'll be using numpy and OpenCV (and matplotlib for plotting the images in our Jupyter notebook, which you can download at the bottom of this page):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
<span style="color:#ff79c6">import</span> cv2
<span style="color:#ff79c6">import</span> matplotlib.pyplot <span style="color:#ff79c6">as</span> plt
<span style="color:#ff79c6">%</span>matplotlib inline
</code></pre></div><p>Since we're working in an Jupyter notebook and we're mixing OpenCV with matplotlib, we'll define some helper functions for showing our images, to make our code shorter and cleaner:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># So we don&#39;t have to use cv2.cvtColor everytime</span>
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">showImage</span>(image):
    plt<span style="color:#ff79c6">.</span>figure()
    plt<span style="color:#ff79c6">.</span>imshow(cv2<span style="color:#ff79c6">.</span>cvtColor(image, cv2<span style="color:#ff79c6">.</span>COLOR_BGR2RGB))
    
<span style="color:#6272a4"># So we can show titled images too</span>
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">showTitledImage</span>(title, image):
    plt<span style="color:#ff79c6">.</span>figure()
    plt<span style="color:#ff79c6">.</span>imshow(cv2<span style="color:#ff79c6">.</span>cvtColor(image, cv2<span style="color:#ff79c6">.</span>COLOR_BGR2RGB))
    plt<span style="color:#ff79c6">.</span>title(title)
    plt<span style="color:#ff79c6">.</span>axis(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">off</span><span style="color:#f1fa8c">&#39;</span>)
</code></pre></div><p>Now we can open our image:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">image <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>imread(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">path/toYour/image.jpg</span><span style="color:#f1fa8c">&#39;</span>)
showImage(image)
</code></pre></div><p><img src="/images/ai/perspective6.jpg" alt="image-20200205172751655"></p>
<p>Next, we'll need to define the region of interest on our input image that we'd like to transform into our birds-eye perspective. You can get these coordinates by opening your image in an image editor and manually selecting the pixels that denote four edges of your ROI.</p>
<p>To help you better understand, here's an image of my ROI:</p>
<p><img src="/images/ai/perspective7.jpg" alt="image-20200205173112267"></p>
<p>Next, you should write down the pixel coordinates of each corner of your image into an numpy array:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Define the region of the image we&#39;re interested in transforming</span>
regionOfInterest <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>float32(
                [[<span style="color:#bd93f9">0</span>,  <span style="color:#bd93f9">180</span>],  <span style="color:#6272a4"># Bottom left</span>
                [<span style="color:#bd93f9">112.5</span>, <span style="color:#bd93f9">87.5</span>], <span style="color:#6272a4"># Top left</span>
                [<span style="color:#bd93f9">200</span>, <span style="color:#bd93f9">87.5</span>], <span style="color:#6272a4"># Top right</span>
                [<span style="color:#bd93f9">307.5</span>, <span style="color:#bd93f9">180</span>]]) <span style="color:#6272a4"># Bottom right</span>
</code></pre></div><p>To clarify, my bottom left coordinate is the pixel where the red and the blue line intersect, whose position is (0, 180). The same goes for the three remaining corners.</p>
<p>I'd like that the selected ROI looks like a square after the transform, where the left and right lane lines are parallel to each other, so I've defined my target perspective coordinates to look like:</p>
<p><img src="/images/ai/perspective8.jpg" alt="image-20200205173429269"></p>
<p>The numpy array containing those coordinates looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Define the destination coordinates for the perspective transform</span>
newPerspective <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>float32(
            [[<span style="color:#bd93f9">80</span>,  <span style="color:#bd93f9">180</span>],  <span style="color:#6272a4"># Bottom left</span>
            [<span style="color:#bd93f9">80</span>,    <span style="color:#bd93f9">0.25</span>],  <span style="color:#6272a4"># Top left</span>
            [<span style="color:#bd93f9">230</span>,   <span style="color:#bd93f9">0.25</span>],  <span style="color:#6272a4"># Top right</span>
            [<span style="color:#bd93f9">230</span>, <span style="color:#bd93f9">180</span>]]) <span style="color:#6272a4"># Bottom right</span>
</code></pre></div><p>So both arrays look like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Define the region of the image we&#39;re interested in transforming</span>
regionOfInterest <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>float32(
                [[<span style="color:#bd93f9">0</span>,  <span style="color:#bd93f9">180</span>],  <span style="color:#6272a4"># Bottom left</span>
                [<span style="color:#bd93f9">112.5</span>, <span style="color:#bd93f9">87.5</span>], <span style="color:#6272a4"># Top left</span>
                [<span style="color:#bd93f9">200</span>, <span style="color:#bd93f9">87.5</span>], <span style="color:#6272a4"># Top right</span>
                [<span style="color:#bd93f9">307.5</span>, <span style="color:#bd93f9">180</span>]]) <span style="color:#6272a4"># Bottom right</span>
                
<span style="color:#6272a4"># Define the destination coordinates for the perspective transform</span>
newPerspective <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>float32(
            [[<span style="color:#bd93f9">80</span>,  <span style="color:#bd93f9">180</span>],  <span style="color:#6272a4"># Bottom left</span>
            [<span style="color:#bd93f9">80</span>,    <span style="color:#bd93f9">0.25</span>],  <span style="color:#6272a4"># Top left</span>
            [<span style="color:#bd93f9">230</span>,   <span style="color:#bd93f9">0.25</span>],  <span style="color:#6272a4"># Top right</span>
            [<span style="color:#bd93f9">230</span>, <span style="color:#bd93f9">180</span>]]) <span style="color:#6272a4"># Bottom right</span>
</code></pre></div><p>If you'd like to visualize your coordinate arrays by drawing lines over the original image like I did above, you can use the following function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Function that draws coordinates on an image, connecting them by lines</span>
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">drawLinesFromCoordinates</span>(coordinates):
    <span style="color:#6272a4"># Pair first point with second, second with third, etc.</span>
    points <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">zip</span>(coordinates, np<span style="color:#ff79c6">.</span>roll(coordinates, <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>))
    <span style="color:#6272a4"># Connect point1 with point2: plt.plot([x1, x2], [y1, y2])</span>
    <span style="color:#ff79c6">for</span> point1, point2 <span style="color:#ff79c6">in</span> points:
        plt<span style="color:#ff79c6">.</span>plot([point1[<span style="color:#bd93f9">0</span>], point2[<span style="color:#bd93f9">0</span>]], [point1[<span style="color:#bd93f9">1</span>], point2[<span style="color:#bd93f9">1</span>]], linewidth<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span>)
</code></pre></div><p>And call it like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Draw the image to visualize the selected region of interest</span>
showTitledImage(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">My ROI</span><span style="color:#f1fa8c">&#34;</span>, image)
drawLinesFromCoordinates(regionOfInterest)
</code></pre></div><p>Once you have your coordinates set, that's actually it. The rest of the implementation just calls a couple OpenCV functions, the first of which is <code>cv2.getPerspectiveTransform</code>, which takes in the starting coordinates we've defined (our ROI) and the target coordinates and gives us back a matrix with which we can warp our image to the target perspective.</p>
<p>This actually isn't that complicated, it's actually pretty simple math which generates a transformation matrix with which tells us how to map some input to a defined output. Also, if you'd like to unwarp your image back into its original perspective, you can get an inverse transformation matrix by calling the  <code>cv2.getPerspectiveTransform</code> and switching the coordinate parameters (see code below).</p>
<p>So all of the above, in code, looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Compute the matrix that transforms the perspective</span>
transformMatrix <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>getPerspectiveTransform(regionOfInterest, newPerspective)

<span style="color:#6272a4"># Compute the inverse matrix for reversing the perspective transform</span>
inverseTransformMatrix <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>getPerspectiveTransform(newPerspective, regionOfInterest)
</code></pre></div><p>Once we have our transformation matrix, we warp our image using <code>cv2.warpPerspective</code>. So when we implement all of the above, we get something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Warp the perspective</span>
<span style="color:#6272a4"># image.shape[:2] takes the height, width, </span>
<span style="color:#6272a4"># [::-1] inverses it to width, height</span>
warpedImage <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>warpPerspective(image, transformMatrix, image<span style="color:#ff79c6">.</span>shape[:<span style="color:#bd93f9">2</span>][::<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>], flags<span style="color:#ff79c6">=</span>cv2<span style="color:#ff79c6">.</span>INTER_LINEAR) 

<span style="color:#6272a4"># If you&#39;d like to see the warped image</span>
showImage(warpedImage)
</code></pre></div><p>And that's it for the perspective transform! If you'd like, you can just plug in the warped image into a convnet and let it find the lane lines from it. But you can also make its job a lot easier by using just a few simple and computationally inexpensive tricks.</p>
<h2 id="making-the-lane-lines-easier-to-see">Making the lane lines easier to see</h2>
<p>There are many different color spaces. We're all most used to the RGB color space. OpenCV uses the BGR color space by default. One color space that's shown to be pretty good for our type of task is called <a href="https://www.wikiwand.com/en/HSL_and_HSV">HSL, and stands for hue, saturation and lightness</a>.</p>
<p>We can convert our warped image from BGR (since we've opened our image using OpenCV and by default it uses BGR) to HSL with the <code>cv2.cvtColor</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Convert the image to HLS colorspace</span>
<span style="color:#6272a4"># Annoyingly enough, OpenCV calls it HLS, not HSL</span>
hlsImage <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>cvtColor(warpedImage, cv2<span style="color:#ff79c6">.</span>COLOR_BGR2HLS)

<span style="color:#6272a4"># Didn&#39;t use showImage since it tries to convert BGR to RGB by default</span>
plt<span style="color:#ff79c6">.</span>imshow(hlsImage)
</code></pre></div><p>So we transform our warped image from RGB:</p>
<p><img src="/images/ai/hsl1.jpg" alt="image-20200205180027118"></p>
<p>To HSL:</p>
<p><img src="/images/ai/hsl1.png" alt="image-20200205180051779"></p>
<p>It certainly doesn't seem any easier to distinguish the lane lines from the HSL image than the RGB image, it actually seems a bit harder, until we split the image into three separate channels:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Split the image into three variables by the channels</span>
hChannel, lChannel, sChannel <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>split(hslImage)
showTitledImage(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">H channel</span><span style="color:#f1fa8c">&#34;</span>, hChannel)
showTitledImage(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">L channel</span><span style="color:#f1fa8c">&#34;</span>, lChannel)
showTitledImage(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">S channel</span><span style="color:#f1fa8c">&#34;</span>, sChannel)
</code></pre></div><p>The hue channel doesn't look very helpful:</p>
<p><img src="/images/ai/hsl2.png" alt="image-20200205180241870"></p>
<p>Neither does the lightness channel:</p>
<p><img src="/images/ai/hsl3.png" alt="image-20200205180307860"></p>
<p>But the saturation channel certainly does:</p>
<p><img src="/images/ai/hsl4.png" alt="image-20200205180331368"></p>
<p>The reason for this is that the <strong>lane lanes are always saturated with color, be it white, yellow or any other color</strong>, which is what makes them stand out in the saturation channel, compared to the asphalt or the sand in the background.</p>
<p>We could've tried to find our lane lines by searching for pixels of a specific color, but that method would be far more susceptible to errors when the lane color changes due to light or weather conditions, or if we come across a lane that's just a bit differently colored than what we've expected, e.g. during construction.</p>
<p>This method is more robust since it doesn't care what color the lane line is, it just cares that it's really saturated with color.</p>
<p>There's one more thing we could do to make the lane lines pop out, as opposed to the lightly activated pixels on the asphalt, the sand on the right and the RC shadow in the middle of the lane. We could threshold the values of the saturation channel image, which basically means we'd only keep the pixels that are above a certain level of saturation, keeping only the most saturated pixels of the image.</p>
<p>That's pretty easy to do using OpenCV, and you can (and should) experiment with the threshold values by using a lot of different pictures of the road taken in different lighting conditions and of different lane line colors.</p>
<p>This is what the code looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Threshold the S channel image to select only the lines</span>
lowerThreshold <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">65</span>
higherThreshold <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">255</span>

<span style="color:#6272a4"># Threshold the image, keeping only the pixels/values that are between lower and higher threshold</span>
returnValue, binaryThresholdedImage <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>threshold(sChannel,lowerThreshold,higherThreshold,cv2<span style="color:#ff79c6">.</span>THRESH_BINARY)

<span style="color:#6272a4"># Since this is a binary image, we&#39;ll convert it to a 3-channel image so OpenCV can use it</span>
<span style="color:#6272a4"># Doesn&#39;t really matter if we use RGB/BGR/anything else</span>
thresholdedImage <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>cvtColor(binaryThresholdedImage, cv2<span style="color:#ff79c6">.</span>COLOR_GRAY2RGB)
showTitledImage(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">Thresholded S channel</span><span style="color:#f1fa8c">&#34;</span>, thresholdedImage)
</code></pre></div><p>Note that the thresholded image will be a binary image, which means that any pixel that was above (or below) our threshold value (i.e. the pixels that we kept) will have a value of 255, which is the maximum value for the color channel (we're using the 0-255 range).</p>
<p>So the output image will look like this:</p>
<p><img src="/images/ai/hsl5.png" alt="image-20200205181031904"></p>
<p>The white pixels are the ones that had a value larger than 65 in the original saturation channel image, and their value is 255 on the above image. The rest of the pixels which didn't cross the lower threshold were discarded and their value was set to 0, which is black in the image above.</p>
<p>We can now feed this image into our network and it'll be much easier for it to find the lane lines.</p>
<h2 id="the-entire-process-visualized">The entire process visualized</h2>
<p>This is what the entire process would look like, in a video:</p>
<center><video controls src="/images/ai/lanelines.mp4" autoplay loop width=80%></video></center>
## Alternative approaches, and why not use them
<p>We also could've used a number of different approaches as opposed to our use of the S channel. We also could've combined multiple of them. A lot of people do. Let's go through some of them and I'll explain why I didn't use them.</p>
<h3 id="fitting-lanes-using-a-polynomial-approximation">Fitting lanes using a polynomial approximation</h3>
<p>One thing I've seen a lot of people do, most of them during their Udacity Self-Driving Car Nanodegree program, is using a sliding window to find the lanes in an image processed in a way similar to ours, and fitting a polynomial to it.</p>
<p>First, they would take the processed binary image and compute a histogram of the lower half of the image, to try and determine where the lane lines begin. This is what such a histogram would look like for our (entire, not just the bottom half) processed image:</p>
<p><img src="/images/ai/hsl5.png" alt="image-20200205181031904"></p>
<p><img src="/images/ai/histogram.png" alt="image-20200205182712746"></p>
<p>You can get the histogram by simply adding up the pixel values on the y axis, for each X-axis value. Here's the code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># Sum the pixels on the x axis</span>
<span style="color:#6272a4"># This will sum all pixel values for a given x axis (column)</span>
histogram <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>sum(binaryThresholdedImage, axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)
plt<span style="color:#ff79c6">.</span>plot(histogram)
</code></pre></div><p>This is what it looks like overlaid on our processed image:</p>
<p><img src="/images/ai/overlay.png" alt="image-20200205184713538"></p>
<p>The method then splits the histogram into two parts, using the two X-axis that have the largest peak in the histogram as the starting positions for the two lane lines, and implements a sliding window search, going from the bottom up, that identifies the positions of all non-zero pixels on the image, and saves them into arrays.</p>
<p>After obtaining the four arrays, two for the left line (x and y) and two for the right one, it uses the numpy <code>polyfit</code> method to fit a polynomial to the line, and thus gets two polynomials that each define the lane.</p>
<p>Once the lanes are found in the first frame, the sliding windows don't go through the entire process again for the next frame. They use the previous frame as a starting position and use a margin at the top of the lane line to detect just the change from the first to the second frame, since it can't change that drastically from one frame to another.</p>
<p>The fitted polynomials can then be easily visualized, and since I've actually implemented this, this is what the result would look like in our simulator:</p>
<center><video controls src="/images/ai/lanefinding.mp4" autoplay muted loop width=100%></video></center>
<p>That looks pretty cool and works relatively well, so why not use it?</p>
<p>Well, I've tried to use it by passing on the fitted polynomials to the network, by passing the warped image with the detected lane overlaid on it:</p>
<p><img src="/images/ai/preview4.jpg" alt=""></p>
<p>and by passing the original image with the detected lane overlaid on it</p>
<p><img src="/images/ai/preview6.jpg" alt=""></p>
<p>The two main issues with the method are:</p>
<ul>
<li>It's computationally expensive to do all of the processing and fitting for every single frame</li>
<li>It can go haywire if your car moves the slightest out of the predefined ROI, and even if you quickly correct it, since it uses the previous frames as a start for the next one, to be more computationally efficient, it would take some time for it to correct itself. I've also tried not using the previous frame and doing all of the work for every single frame, and it takes a lot of computational power to do so.</li>
</ul>
<p>Also, I wouldn't like my model to rely so much on feature engineering and extraction, I'd like it to be more robust, even if it means it will be harder to train or take longer to train. By simply passing our processed image to a small convolutional network, it should be able to get all the information it needs from it, and it should be way less computationally expensive in the long run, even if we've added a couple of additional convolutional layers to our model. Even if we passed the fitted polynomials to the network, we'd still have to train the network to learn how to interpret them, and taking into consideration the short tests I did, I believe it would be less robust and even more computationally expensive to do so.</p>
<h3 id="using-additional-preprocessing-methods">Using additional preprocessing methods</h3>
<p>Apart from transforming the perspective of our image and getting the thresholded S channel image, we could've also used a number of different techniques to make the lane lines more visible. One example would be using the Sobel operator, which allows us to take the derivative of an image in the x or the y direction.</p>
<p>I've tried a number of them, including Sobel, which I'll show below, and I've found that they wouldn't really help much, at least on my test data.</p>
<p>Here's an example of Sobel on both axes using these two input pictures:</p>
<p><img src="/images/ai/graywarped.jpg" alt="graywarped"><img src="/images/ai/schannel.jpg" alt="schannel"></p>
<p>Here's the images after applying the Sobel operator over both axes:</p>
<p><img src="/images/ai/sobel1.jpg" alt="image-20200205194430479"></p>
<p>Here are the above images after <code>np.absolute</code>:</p>
<p><img src="/images/ai/sobel2.jpg" alt="image-20200205194502512"></p>
<p>And here are the above images after applying a binary threshold on them, with the lower threshold being 200 and the upper 255:</p>
<p><img src="/images/ai/sobel3.jpg" alt="image-20200205194619798"></p>
<p>Here's the code if you want to try it out for yourself:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">showSobelImages</span>(images):
    f, axarr <span style="color:#ff79c6">=</span> plt<span style="color:#ff79c6">.</span>subplots(<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">2</span>)
    axarr[<span style="color:#bd93f9">0</span>,<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>imshow(images[<span style="color:#bd93f9">0</span>], cmap<span style="color:#ff79c6">=</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">gray</span><span style="color:#f1fa8c">&#39;</span>)
    axarr[<span style="color:#bd93f9">0</span>,<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>axis(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">off</span><span style="color:#f1fa8c">&#39;</span>)
    axarr[<span style="color:#bd93f9">0</span>,<span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>imshow(images[<span style="color:#bd93f9">1</span>], cmap<span style="color:#ff79c6">=</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">gray</span><span style="color:#f1fa8c">&#39;</span>)
    axarr[<span style="color:#bd93f9">0</span>,<span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>axis(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">off</span><span style="color:#f1fa8c">&#39;</span>)
    axarr[<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>imshow(images[<span style="color:#bd93f9">2</span>], cmap<span style="color:#ff79c6">=</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">gray</span><span style="color:#f1fa8c">&#39;</span>)
    axarr[<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>axis(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">off</span><span style="color:#f1fa8c">&#39;</span>)
    axarr[<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>imshow(images[<span style="color:#bd93f9">3</span>], cmap<span style="color:#ff79c6">=</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">gray</span><span style="color:#f1fa8c">&#39;</span>)
    axarr[<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>axis(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">off</span><span style="color:#f1fa8c">&#39;</span>)


grayWarpedImage <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>cvtColor(warpedImage, cv2<span style="color:#ff79c6">.</span>COLOR_BGR2GRAY)
plt<span style="color:#ff79c6">.</span>imsave(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">graywarped.jpg</span><span style="color:#f1fa8c">&#39;</span>, grayWarpedImage, cmap<span style="color:#ff79c6">=</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">gray</span><span style="color:#f1fa8c">&#39;</span>)
plt<span style="color:#ff79c6">.</span>imsave(<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">schannel.jpg</span><span style="color:#f1fa8c">&#39;</span>, sChannel, cmap<span style="color:#ff79c6">=</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">gray</span><span style="color:#f1fa8c">&#39;</span>)
<span style="color:#6272a4"># Taking the derivative on the X-axis</span>
xAxisSobelWarped <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>Sobel(grayWarpedImage, cv2<span style="color:#ff79c6">.</span>CV_64F, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>, ksize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span>)
xAxisSobelSChannel <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>Sobel(grayWarpedImage, cv2<span style="color:#ff79c6">.</span>CV_64F, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>, ksize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span>)

<span style="color:#6272a4"># Taking the derivative on the Y-axis</span>
yAxisSobelWarped <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>Sobel(grayWarpedImage, cv2<span style="color:#ff79c6">.</span>CV_64F, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">1</span>, ksize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span>)
yAxisSobelSChannel <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>Sobel(grayWarpedImage, cv2<span style="color:#ff79c6">.</span>CV_64F, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">1</span>, ksize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span>)

images <span style="color:#ff79c6">=</span> [xAxisSobelWarped, xAxisSobelSChannel, yAxisSobelWarped, yAxisSobelSChannel]
showSobelImages(images)

<span style="color:#6272a4"># Absolute values</span>
showSobelImages([np<span style="color:#ff79c6">.</span>absolute(x) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> images])

lowerThreshold <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">200</span>
higherThreshold <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">255</span>
thresholdedImages <span style="color:#ff79c6">=</span> []
<span style="color:#ff79c6">for</span> image <span style="color:#ff79c6">in</span> images:
    returnValue, image <span style="color:#ff79c6">=</span> cv2<span style="color:#ff79c6">.</span>threshold(np<span style="color:#ff79c6">.</span>absolute(image), lowerThreshold,higherThreshold, cv2<span style="color:#ff79c6">.</span>THRESH_BINARY)
    thresholdedImages <span style="color:#ff79c6">+</span><span style="color:#ff79c6">=</span> [image]
showSobelImages(thresholdedImages)
</code></pre></div><h3 id="and-you-can-download-the-entire-jupyter-notebook-below">And you can download the entire Jupyter notebook below:</h3>

<section class="attachments grey">
	<label>
		<i class="fas fa-paperclip" aria-hidden="true"></i>
		Jupyter notebook
	</label>
	
		
	
	<div class="attachments-files">
	
		
		
			
				<li>
					<a href="/Artificial%20Intelligence/computer%20vision%20lane%20finding.files/laneFinding.ipynb" >
						laneFinding.ipynb
					</a>
					(1413 ko)
				</li>
			
		
	
	<div>
	
</section>




<footer class=" footline" >
	
</footer>


        
        </div> 
		
        
<script src="https://utteranc.es/client.js"
        repo="ivanorsolic/oricodes"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/artificial-intelligence/camera-calibration/calibrating-the-camera/" title="Camera calibration: Calibrating the camera and undistorting images"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/artificial-intelligence/integrating-the-lane-finding/" title="Advanced lane finding model" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>
    </section>
    
		
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/js/jquery.sticky.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    
    <script src="/js/modernizr.custom-3.6.0.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>

    <link href="/mermaid/mermaid.css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
	
  </body>
</html>

