<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.62.1" />
    <meta name="description" content="Ori&#39;s self-driving RC car">
<meta name="author" content="ori">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Using a gamepad :: Ori Engineering</title>

    
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/css/auto-complete.css" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/hugo-theme.css" rel="stylesheet">
    
      <link href="/css/theme-mine.css" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/software/connecting-a-bluetooth-gamepad/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ori.codes/">
  <img src="/images/logo.png">
</a>

	  1642 words.<br>
	  Reading time: 8 minutes.
	  
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js"></script>
<script type="text/javascript" src="/js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ori.codes\/";
    
</script>
<script type="text/javascript" src="/js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/rc-car/" title="RC Cars: a primer" class="dd-item 
        
        
        
        ">
      <a href="/rc-car/">
          <b>1. </b>RC Cars: a primer
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/rc-car/parts_list/" title="Parts: an overview" class="dd-item ">
        <a href="/rc-car/parts_list/">
        Parts: an overview
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/scale/" title="Scale" class="dd-item ">
        <a href="/rc-car/scale/">
        Scale
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/body_type/" title="RC Car body types" class="dd-item ">
        <a href="/rc-car/body_type/">
        Body type
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/electric_motors/" title="Electric motors" class="dd-item ">
        <a href="/rc-car/electric_motors/">
        Electric motors
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/servo/" title="Steering servo" class="dd-item ">
        <a href="/rc-car/servo/">
        Servo
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/electronic_speed_controller/" title="Electronic Speed Controller" class="dd-item ">
        <a href="/rc-car/electronic_speed_controller/">
        ESC
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/receiver/" title="Receiver" class="dd-item ">
        <a href="/rc-car/receiver/">
        Receiver
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/rc-car/batteries/" title="Batteries" class="dd-item ">
        <a href="/rc-car/batteries/">
        Batteries
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/hardware/" title="Hardware" class="dd-item 
        
        
        
        ">
      <a href="/hardware/">
          <b>2. </b>Hardware
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/hardware/inventory/" title="Hardware inventory" class="dd-item ">
        <a href="/hardware/inventory/">
        Inventory: stuff you&#39;ll need
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/building-the-car/" title="Assembling the RC Car" class="dd-item ">
        <a href="/hardware/building-the-car/">
        Assembling the RC Car
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/mounting-plates/" title="Building the mounting plates for the hardware" class="dd-item ">
        <a href="/hardware/mounting-plates/">
        Mounting plates
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/jetson-nano-installation/" title="Preparing the Jetson Nano" class="dd-item ">
        <a href="/hardware/jetson-nano-installation/">
        Preparing the Jetson Nano
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/assembling-the-nano/" title="Assembling the Jetson Nano" class="dd-item ">
        <a href="/hardware/assembling-the-nano/">
        Assembling the Jetson Nano
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/hardware/connecting-the-car-to-the-nano/" title="Connecting the RC to the Nano" class="dd-item ">
        <a href="/hardware/connecting-the-car-to-the-nano/">
        Connecting the RC to the Nano
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/software/" title="Software" class="dd-item 
        parent
        
        
        ">
      <a href="/software/">
          <b>3. </b>Software
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/software/kernel-hacking/" title="Running the OS from an external SSD using a custom kernel" class="dd-item ">
        <a href="/software/kernel-hacking/">
        OPTIONAL: Kernel Hacking
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar/" title="DonkeyCar" class="dd-item ">
        <a href="/software/donkeycar/">
        DonkeyCar: Explained
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar-host/" title="DonkeyCar installation: Host PC" class="dd-item ">
        <a href="/software/donkeycar-host/">
        DonkeyCar: Host PC
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar-simulator/" title="DonkeyCar Installation: The Simulator" class="dd-item ">
        <a href="/software/donkeycar-simulator/">
        DonkeyCar: Simulator
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/donkeycar-rc/" title="DonkeyCar installation: RC car" class="dd-item ">
        <a href="/software/donkeycar-rc/">
        DonkeyCar: RC car
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/setting-up-donkeycar-on-the-rc/" title="DonkeyCar configuration: RC car" class="dd-item ">
        <a href="/software/setting-up-donkeycar-on-the-rc/">
        DonkeyCar configuration: RC car
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/calibrating-steering-and-throttle/" title="Calibrating steering and throttle" class="dd-item ">
        <a href="/software/calibrating-steering-and-throttle/">
        Calibrating steering and throttle
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/connecting-a-bluetooth-gamepad/" title="Using a gamepad" class="dd-item active">
        <a href="/software/connecting-a-bluetooth-gamepad/">
        Using a gamepad
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/test-driving-the-rc/" title="Test drive" class="dd-item ">
        <a href="/software/test-driving-the-rc/">
        Test drive
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/software/sanity-check-first-autopilot/" title="First Autopilot: sanity check" class="dd-item ">
        <a href="/software/sanity-check-first-autopilot/">
        First Autopilot: sanity check
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/artificial-intelligence/" title="Artificial Intelligence" class="dd-item 
        
        
        
        ">
      <a href="/artificial-intelligence/">
          <b>4. </b>Artificial Intelligence
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    


    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://ori.codes/software/connecting-a-bluetooth-gamepad/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
	  
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
	  
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/ivanorsolic"><i class='fab fa-github'></i> Github</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://twitter.com/ivanorsolic"><i class='fab fa-twitter'></i> Twitter</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://ivanorsolic.github.io"><i class='fas fa-tasks'></i> Other stuff</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://drive.google.com/file/d/1c4F5kfnWZnwQciP8gKyKunzDOqBJ5gDM/view?usp=sharing"><i class='fas fa-file'></i> My CV</a>
              </li>
          
        </ul>
      </section>
    
      </ul>
    </section>
    
	
    <section id="footer">
      <p align="center">Built by <a href="https://twitter.com/ivanorsolic">Ori</a> with <a href="https://github.com/matcornic/hugo-theme-learn">Learn</i></a>, <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo.</a><br>
Hosted for free at <a href="https://app.netlify.com">Netlify <i class="fas fa-heart"></i></a>
</p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Using a gamepad 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#compatible-controllers">Compatible controllers</a></li>
    <li><a href="#connecting-your-controller">Connecting your controller</a>
      <ul>
        <li><a href="#xbox-one-controller">Xbox (One) Controller</a></li>
        <li><a href="#ps4-controller">PS4 Controller</a></li>
        <li><a href="#ps3-controller">PS3 Controller</a></li>
      </ul>
    </li>
    <li><a href="#any-other-gamepadjoystickcontroller">Any other gamepad/joystick/controller</a></li>
    <li><a href="#creating-a-buttonaxis-mapping">Creating a Button/Axis mapping:</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Using a gamepad
            </h1>
          

        



<p><img src="/images/software/gamepad.png" alt="Gamepad"></p>
<p>You can, and should, use a gamepad to control your RC. It's much easier to generate good training data using a gamepad, and it's much easier to drive the thing compared to the Web interface that Donkey provides.</p>
<p>So how do we connect and use one?</p>
<h2 id="compatible-controllers">Compatible controllers</h2>
<p>First, let's make sure you have one that'll actually work</p>
<p><a href="https://docs.donkeycar.com/parts/controllers/#physical-joystick-controller">The official Donkey docs</a> list that the following are known to work:</p>
<ul>
<li><a href="https://www.amazon.com/Logitech-940-000117-Gamepad-F710/dp/B0041RR0TW">Logitech Gamepad F710</a></li>
<li>Sony PS3 Dualshock OEM</li>
<li><a href="https://www.ebay.com/sch/i.html?&amp;_nkw=Sony+PS3+Sixaxis+OEM">Sony PS3 Sixaxis OEM</a> (Not compatible with Jetson Nano)</li>
<li><a href="https://www.ebay.com/sch/i.html?&amp;_nkw=Sony+PS4+Dualshock+OEM">Sony PS4 Dualshock OEM</a></li>
<li><a href="https://www.amazon.com/Nintendo-Wii-U-Pro-Controller-Black/dp/B00MUY0OFU">WiiU Pro</a></li>
<li><a href="https://www.amazon.com/Xbox-Wireless-Controller-Blue-one/dp/B01M0F0OIY">XBox Controller</a></li>
<li><a href="https://www.amazon.com/gp/product/B01AZC3III">SteelSeries Nimbus</a> (works only on TX2 jetpack 4.2+, may work on the Nano)</li>
</ul>
<p>Depending on the controller you're going to use, open up the <code>myconfig.py</code> file and find the <code># JOYSTICK</code> section and uncomment and fill the following (using one of the types suggested inline with the setting):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">CONTROLLER_TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xbox&#39;</span>               <span style="color:#75715e">#(ps3|ps4|xbox|nimbus|wiiu|F710|rc3)</span>
</code></pre></div><p>If your gamepad isn't <em>officially</em> supported, try following the rest of the tutorial and connecting it to the Nano. If it shows up as <code>/dev/input/js0</code>, you should be able to use it, since the Donkey platform just uses that OS device mount as the gamepad.</p>
<h2 id="connecting-your-controller">Connecting your controller</h2>
<h3 id="xbox-one-controller">Xbox (One) Controller</h3>
<p><img src="/images/software/xbone.png?height=15pc" alt="Xbox One Controller"></p>
<p>The Xbox controller doesn't like the <em>Enhanced Re-Transmission Mode</em>, so we'll disable it first.</p>
<p>Open up the <code>/etc/modprobe.d/xbox_bt.conf</code> file (this may actually create the file if it doesn't exist yet):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo nano /etc/modprobe.d/xbox_bt.conf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Add this line and save the file</span>
options bluetooth disable_ertm<span style="color:#f92672">=</span>1
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Reboot</span>
sudo reboot
</code></pre></div><p>After rebooting, check it's actually disabled by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /sys/module/bluetooth/parameters/disable_ertm
</code></pre></div><p>It should say &lsquo;<strong>Y</strong>'. If it does, open up bluetoothctl:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo bluetoothctl
</code></pre></div><pre><code># Register the default agent
agent on
# Default agent request
default-agent
# Scan for devices
scan on
</code></pre><p>Turn on your Xbox controller (by pressing the big <strong>Xbox logo button</strong>) and start the pairing mode by pressing the <strong>sync</strong> button on the back of the controller, next to the microUSB port.</p>
<p>You should see your controller show up in bluetoothctl similar to:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>NEW<span style="color:#f92672">]</span> Device YO:UR:MA:CA:DD:RS XBox One Wireless Controller
</code></pre></div><p>Type in:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># This may take a few tries ...</span>
connect YOUR_MAC_ADDRESS
<span style="color:#75715e"># If it connects but immediately disconnects, the disable_ertm setting isn&#39;t properly set up, try doing that again</span>
<span style="color:#75715e"># When it connects and the big Xbox logo button is solid white:</span>
trust YOUR_MAC_ADDRESS
quit
</code></pre></div><p>Once connected, it should automatically reconnect anytime the Jetson and it are both powered on. If it doesn't, you'll have to run the steps above again.</p>
<h3 id="ps4-controller">PS4 Controller</h3>
<p><img src="/images/software/ps4.png?height=15pc" alt=""></p>
<p>Install ds4drv:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo pip install ds4drv
</code></pre></div><p>Grant it permissions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo wget https://raw.githubusercontent.com/chrippa/ds4drv/master/udev/50-ds4drv.rules -O /etc/udev/rules.d/50-ds4drv.rules
sudo udevadm control --reload-rules
sudo udevadm trigger
sudo reboot
</code></pre></div><p>After rebooting run ds4drv:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># --led changes the light bar color, you can modify it or not use it at all</span>
<span style="color:#75715e"># --hidraw doesn&#39;t play well with some controllers, if you&#39;re having issues, try not using it</span>
ds4drv --hidraw --led 00ff00
</code></pre></div><p>Start the controller in pairing mode:</p>
<ul>
<li>Press and hold <strong>Share</strong> button</li>
<li>Press and hold <strong>PS</strong> button until the light bar starts blinking</li>
<li>If it goes <strong>green</strong> after a few seconds, pairing is successful.</li>
</ul>
<p>To run ds4drv on boot, open up <code>/etc/rc.local</code> and paste in the command you used to start ds4drv:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo nano /etc/rc.local
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Paste in (with or without --hidraw and --led):</span>
/home/YOUR-USERNAME/env/bin/ds4drv --led 00ff00
</code></pre></div><h3 id="ps3-controller">PS3 Controller</h3>
<p>The Donkey docs say to follow <a href="https://pythonhosted.org/triangula/sixaxis.html">this guide</a>, or you can just run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install bluetooth libbluetooth3 libusb-dev
sudo systemctl enable bluetooth.service
sudo usermod -G bluetooth -a pi
sudo reboot
</code></pre></div><p>After rebooting, plug in the controller with an USB cable, press the <strong>PS button</strong> and:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget http://www.pabr.org/sixlinux/sixpair.c
gcc -o sixpair sixpair.c -lusb
sudo ./sixpair
</code></pre></div><p>Run bluetoothctl as a super user and pair your controller:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo bluetoothctl
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Enable the default agent</span>
agent on
<span style="color:#75715e"># List all found devices and get your controller&#39;s MAC address</span>
devices
<span style="color:#75715e"># Trust your controller</span>
trust &lt;MAC ADDRESS&gt;
<span style="color:#75715e"># Default agent request</span>
default-agent
<span style="color:#75715e"># Quit</span>
quit
</code></pre></div><p>Unplug the USB cable and press the <strong>PS button</strong>. Your controller should be mounted at <code>ls /dev/input/js0</code>.</p>
<h2 id="any-other-gamepadjoystickcontroller">Any other gamepad/joystick/controller</h2>
<p>If it's a Bluetooth one, try pairing it via bluetoothctl and see if it mounts at <code>/dev/input/js0</code>. If it does, great, you can move on.</p>
<p>If not, try connecting it via USB and see if it mounts at  <code>/dev/input/js0</code>, if it does, you're good.</p>
<p>If neither goes, try searching how to connect that particular controller to a Linux device online, if there's a way (mostly there is), it should mount at the above mentioned <code>js0</code> and you should be able to follow along.</p>
<h2 id="creating-a-buttonaxis-mapping">Creating a Button/Axis mapping:</h2>
<p>After your controller is connected, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">donkey createjs
</code></pre></div><p>The output should be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##</span>
<span style="color:#75715e">## Welcome to Joystick Creator Wizard. ##</span>
<span style="color:#75715e">##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##</span>
This will generate code to use your joystick with a Donkey car.

Overview:

First we name each button, <span style="color:#66d9ef">then</span> each axis control.
Next we map names to actions.
Finally we output a python file you can use in your project.

Hit Enter to <span style="color:#66d9ef">continue</span>

<span style="color:#75715e"># After pressing Enter</span>
Please plug-in your controller via USB or bluetooth. Make sure status lights are on and device is mapped.
Enter to <span style="color:#66d9ef">continue</span>
<span style="color:#75715e"># You can press enter since we&#39;ve already gone through connecting your controller</span>

Where can we find the device file <span style="color:#66d9ef">for</span> your joystick?
Hit Enter <span style="color:#66d9ef">for</span> default: /dev/input/js0 or type alternate path:
<span style="color:#75715e"># Should be /dev/input/js0 if it&#39;s a PS3/PS4/Xbox/Standard USB one</span>
<span style="color:#75715e"># Hit enter and see if it finds it (it will if its on /dev/input/js0)</span>

Attempting to open device at that file...
Opening /dev/input/js0...
Device name: The type of Controller you<span style="color:#e6db74">&#39;re using
</span><span style="color:#e6db74">Found and accessed input device.
</span><span style="color:#e6db74"># After pressing Enter
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Next we are going to look for gyroscope data.
</span><span style="color:#e6db74">For 5 seconds, move controller and rotate on each axis. Hit Enter then start moving:
</span><span style="color:#e6db74"># You can skip this, since you most probably won&#39;</span>t be using it

Ok, we didn<span style="color:#e6db74">&#39;t see any events. So perhaps your controller doesn&#39;</span>t emit gyroscope data. No problem.
</code></pre></div><p>Finally, you'll get to this part:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">We will display the current progress in this set of tables:

Button Map:
+-------------+-------------+
| button code | button name |
+-------------+-------------+
+-------------+-------------+
Axis Map:
+-----------+-----------+
| axis code | axis name |
+-----------+-----------+
+-----------+-----------+
Control Map:
+---------+--------+
| control | action |
+---------+--------+
+---------+--------+

As you name buttons and map them to controls this table will be updated.

</code></pre></div><p>While in here, you should go through pressing every button on your controller, and giving it a name.</p>
<p>Note: during this first step, you can only map buttons, the axes, such as triggers or analog sticks will come next.</p>
<p>For my Xbox One Controller, I made the following button map:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Button Map:
+-------------+-------------+
| button code | button name |
+-------------+-------------+
|    0x130    |      A      |
|    0x131    |      B      |
|    0x133    |      Y      |
|    0x132    |      X      |
|    0x137    |    Start    |
|    0x136    |    Select   |
|    0x135    |      R1     |
|    0x134    |      L1     |
|    0x139    |      RS     |
|    0x138    |      LS     |
+-------------+-------------+
</code></pre></div><p>After mapping all the buttons, wait for 10 seconds and enter <code>Y</code> when the program asks you if you've finished mapping all the buttons.</p>
<p>This is what my axis map looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Axis Map:
+-----------+-------------------------+
| axis code |        axis name        |
+-----------+-------------------------+
|    0x5    |            RT           |
|    0x2    |            LT           |
|    0x0    |  Left Stick: Horizontal |
|    0x1    |   Left Stick: Vertical  |
|    0x4    |  Right Stick: Vertical  |
|    0x3    | Right Stick: Horizontal |
+-----------+-------------------------+
</code></pre></div><p>You can enter <code>D</code> when you're done and move on to the control map, through which we'll map buttons and axes to specific car controls.</p>
<p>This is what my control map looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Control Map:
+------------------------+--------------------------+
|        control         |          action          |
+------------------------+--------------------------+
|         Start          |       toggle_mode        |
|         Select         |   erase_last_N_records   |
|           A            |      emergency_stop      |
|           R1           |  increase_max_throttle   |
|           L1           |  decrease_max_throttle   |
|           B            | toggle_constant_throttle |
|           X            | toggle_manual_recording  |
| Left Stick: Horizontal |       set_steering       |
| Right Stick: Vertical  |       set_throttle       |
+------------------------+--------------------------+
</code></pre></div><p>If you've messed something up, don't worry, at the next menu you can go back to any step you'd like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Now we are nearly <span style="color:#66d9ef">done</span>! Are you happy with this config or would you like to revisit a topic?
H<span style="color:#f92672">)</span>appy, please <span style="color:#66d9ef">continue</span> to write out python file.
B<span style="color:#f92672">)</span>uttons need renaming.
A<span style="color:#f92672">)</span>xes need renaming.
T<span style="color:#f92672">)</span>hrottle and steering need remap.
R<span style="color:#f92672">)</span>emap buttons to controls.
</code></pre></div><p>If you're happy with your maps, enter <code>H</code> and it will prompt you for a name under which to save your mapping. The default one is <code>my_joystick.py</code>, but you can enter a custom one, if you're planning to use multiple different controllers, or just for non-generic-naming's sake:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Now we will write these values to a new python file.
What is the name of python file to create joystick code? <span style="color:#f92672">[</span>default: my_joystick.py<span style="color:#f92672">]</span> xbox_one_controller.py
</code></pre></div><p>It will then ask what to name the custom Python class of the controller you've just created:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">What is the name of joystick class? <span style="color:#f92672">[</span>default: MyJoystick<span style="color:#f92672">]</span> XboxOneController
xbox_one_controller.py written.
Check your new python file to see the controller implementation. Import this in manage.py and use <span style="color:#66d9ef">for</span> control.
</code></pre></div><p>Almost there, we just need to import our custom mapping in the <code>manage.py</code> script to be able to use it with our RC.</p>
<p>Open up <code>manage.py</code> (<code>nano</code> or <code>vim</code>) and at the end of the imports, find the following line:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> donkeycar.parts.controller <span style="color:#f92672">import</span> get_js_controller

ctr <span style="color:#f92672">=</span> get_js_controller(cfg)
</code></pre></div><p>And replace it with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># This assumes you haven&#39;t changed the default names</span>
<span style="color:#f92672">from</span> my_joystick <span style="color:#f92672">import</span> MyJoystick

ctr <span style="color:#f92672">=</span> MyJoystick(throttle_dir<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>JOYSTICK_THROTTLE_DIR,
                                throttle_scale<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>JOYSTICK_MAX_THROTTLE,
                                steering_scale<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>JOYSTICK_STEERING_SCALE,
                                auto_record_on_throttle<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>AUTO_RECORD_ON_THROTTLE)

ctr<span style="color:#f92672">.</span>set_deadzone(cfg<span style="color:#f92672">.</span>JOYSTICK_DEADZONE)
</code></pre></div><p>Or if you've defined a custom name for the python file containing your mapping, and the class it contains, which I did, then modify the import line so it uses your custom script and class name:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># In my case</span>
<span style="color:#f92672">from</span> xbox_one_controller <span style="color:#f92672">import</span> XboxOneController

ctr <span style="color:#f92672">=</span> XboxOneController(throttle_dir<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>JOYSTICK_THROTTLE_DIR,
                                throttle_scale<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>JOYSTICK_MAX_THROTTLE,
                                steering_scale<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>JOYSTICK_STEERING_SCALE,
                                auto_record_on_throttle<span style="color:#f92672">=</span>cfg<span style="color:#f92672">.</span>AUTO_RECORD_ON_THROTTLE)

ctr<span style="color:#f92672">.</span>set_deadzone(cfg<span style="color:#f92672">.</span>JOYSTICK_DEADZONE)
</code></pre></div><p>And you're done! Now we can start actually driving the car using our controller!</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
		
        
<script src="https://utteranc.es/client.js"
        repo="ivanorsolic/oriengineering"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/software/calibrating-steering-and-throttle/" title="Calibrating steering and throttle"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/software/test-driving-the-rc/" title="Test drive" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>
    </section>
    
		
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/js/jquery.sticky.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>

    <link href="/mermaid/mermaid.css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
	
  </body>
</html>

